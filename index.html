<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Priya Electrical | Industrial Vendor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ORIGINAL LOGIC WITH GITHUB FALLBACK ---
        let firebaseConfig;
        try {
            // This tries to use your original "backend" method
            firebaseConfig = JSON.parse(__firebase_config);
        } catch (e) {
            // This is the "Correct" way for GitHub Pages: Put your real keys here!
            firebaseConfig = {
                apiKey: "YOUR_API_KEY",
                authDomain: "YOUR_PROJECT.firebaseapp.com",
                projectId: "YOUR_PROJECT_ID",
                storageBucket: "YOUR_PROJECT.appspot.com",
                messagingSenderId: "YOUR_SENDER_ID",
                appId: "YOUR_APP_ID"
            };
        }

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const DATABASE_ID = 'priya-electrical-v2';

        // Helper for icons
        const Icon = ({ name, className = "w-5 h-5" }) => {
            useEffect(() => { lucide.createIcons(); }, []);
            return <i data-lucide={name} className={className}></i>;
        };

        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('home');
            const [orders, setOrders] = useState([]);
            const [materials, setMaterials] = useState([]);
            const [isAdmin, setIsAdmin] = useState(false);

            useEffect(() => {
                auth.signInAnonymously().catch(console.error);
                auth.onAuthStateChanged(setUser);
            }, []);

            useEffect(() => {
                if (!user) return;
                // EXACT path from your original logic
                const docRef = db.collection('artifacts').doc(DATABASE_ID).collection('public').doc('data');
                
                const unsubO = docRef.collection('orders').onSnapshot(s => setOrders(s.docs.map(d => ({id: d.id, ...d.data()}))));
                const unsubM = docRef.collection('materials').onSnapshot(s => setMaterials(s.docs.map(d => ({id: d.id, ...d.data()}))));
                
                return () => { unsubO(); unsubM(); };
            }, [user]);

            // YOUR ORIGINAL SUBMIT LOGIC
            const handleSubmit = async (data, type) => {
                const col = type === 'material' ? 'materials' : 'orders';
                await db.collection('artifacts').doc(DATABASE_ID).collection('public').doc('data').collection(col).add({
                    ...data,
                    userId: user.uid,
                    status: 'pending',
                    timestamp: new Date().toISOString()
                });
                setView('track');
            };

            return (
                <div className="min-h-screen font-sans text-slate-900">
                    <nav className="bg-white border-b p-4 flex justify-between items-center sticky top-0 z-50">
                        <div className="flex items-center gap-2" onClick={() => setView('home')}>
                            <div className="bg-blue-600 p-1 rounded text-white"><Icon name="zap" /></div>
                            <h1 className="text-xl font-bold">PriyaElectrical</h1>
                        </div>
                        <div className="hidden md:flex gap-6 text-sm font-semibold">
                            <button onClick={() => setView('home')}>Home</button>
                            <button onClick={() => setView('about')}>About</button>
                            <button onClick={() => setView('quote')}>Get Quote</button>
                            <button onClick={() => setView('material')}>Materials</button>
                            <button onClick={() => setView('track')}>Track</button>
                        </div>
                        <button onClick={() => setIsAdmin(!isAdmin)} className="bg-black text-white px-4 py-2 rounded-full text-xs">
                            {isAdmin ? 'Exit' : 'Admin'}
                        </button>
                    </nav>

                    <main className="max-w-7xl mx-auto p-6">
                        {isAdmin ? (
                            <AdminPanel orders={orders} materials={materials} db={db} dbId={DATABASE_ID} />
                        ) : (
                            <React.Fragment>
                                {view === 'home' && <Home setView={setView} />}
                                {view === 'about' && <About />}
                                {view === 'quote' && <RequestForm type="quote" onSubmit={handleSubmit} />}
                                {view === 'material' && <RequestForm type="material" onSubmit={handleSubmit} />}
                                {view === 'track' && <Tracking orders={orders} materials={materials} />}
                            </React.Fragment>
                        )}
                    </main>
                </div>
            );
        }

        // --- COMPONENTS (YOUR ORIGINAL UI) ---

        function Home({ setView }) {
            const items = [
                { name: "HT/LT Cables", icon: "zap", img: "https://images.unsplash.com/photo-1621905251918-48416bd8575a?w=400" },
                { name: "Solar Systems", icon: "sun", img: "https://images.unsplash.com/photo-1508514177221-188b1cf16e9d?w=400" },
                { name: "Raw Materials", icon: "factory", img: "https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=400" }
            ];
            return (
                <div className="space-y-12">
                    <div className="h-[400px] rounded-[2rem] overflow-hidden relative shadow-xl">
                        <img src="https://images.unsplash.com/photo-1473341304170-971dccb5ac1e?w=1200" className="w-full h-full object-cover" />
                        <div className="absolute inset-0 bg-black/40 flex flex-col justify-center p-12 text-white">
                            <h2 className="text-5xl font-extrabold mb-4">Priya Electrical</h2>
                            <p className="text-xl mb-8">Industrial Infrastructure Specialists</p>
                            <button onClick={() => setView('quote')} className="bg-blue-600 w-fit px-8 py-4 rounded-xl font-bold">Start Project</button>
                        </div>
                    </div>
                    <div className="grid md:grid-cols-3 gap-8">
                        {items.map(i => (
                            <div key={i.name} className="bg-white rounded-3xl overflow-hidden shadow-sm border border-slate-100 hover:shadow-lg transition-all">
                                <img src={i.img} className="h-40 w-full object-cover" />
                                <div className="p-6">
                                    <h3 className="text-xl font-bold">{i.name}</h3>
                                    <button onClick={() => setView('quote')} className="mt-4 text-blue-600 font-bold flex items-center gap-2">Details <Icon name="arrow-right" size={14} /></button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function About() {
            return (
                <div className="max-w-4xl mx-auto py-10 bg-white p-10 rounded-[2rem] border shadow-sm">
                    <h2 className="text-3xl font-bold mb-6">About Us</h2>
                    <p className="text-slate-600 mb-8 leading-relaxed">Priya Electrical is a leading industrial vendor specializing in power distribution and solar infrastructure. We provide certified components and expert engineering solutions.</p>
                    <div className="grid grid-cols-2 gap-4">
                        <div className="bg-blue-50 p-6 rounded-2xl"><Icon name="phone" className="mb-2 text-blue-600"/><p className="font-bold">8147267247</p></div>
                        <div className="bg-blue-50 p-6 rounded-2xl"><Icon name="mail" className="mb-2 text-blue-600"/><p className="font-bold">Raju@#324@gmail.com</p></div>
                    </div>
                </div>
            );
        }

        function RequestForm({ type, onSubmit }) {
            const [f, setF] = useState({ name: '', phone: '', details: '' });
            return (
                <div className="max-w-xl mx-auto bg-white p-10 rounded-[2.5rem] shadow-xl border">
                    <h2 className="text-3xl font-bold mb-6">{type === 'material' ? 'Source Material' : 'Get Quote'}</h2>
                    <form onSubmit={e => { e.preventDefault(); onSubmit(f, type); }} className="space-y-4">
                        <input required className="w-full p-4 bg-slate-50 border rounded-xl" placeholder="Name" onChange={e => setF({...f, name: e.target.value})} />
                        <input required className="w-full p-4 bg-slate-50 border rounded-xl" placeholder="Phone" onChange={e => setF({...f, phone: e.target.value})} />
                        <textarea required className="w-full p-4 bg-slate-50 border rounded-xl" placeholder="Details" rows="4" onChange={e => setF({...f, details: e.target.value})}></textarea>
                        <button className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold">Submit</button>
                    </form>
                </div>
            );
        }

        function Tracking({ orders, materials }) {
            const all = [...orders, ...materials].sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));
            return (
                <div className="max-w-2xl mx-auto space-y-4">
                    <h2 className="text-2xl font-bold mb-4">Request Status</h2>
                    {all.map(i => (
                        <div key={i.id} className="bg-white p-6 rounded-2xl border flex justify-between items-center">
                            <div><p className="font-bold">{i.name}</p><p className="text-xs text-slate-400">{i.timestamp}</p></div>
                            <span className="bg-amber-100 text-amber-700 px-3 py-1 rounded-full text-xs font-bold uppercase">{i.status}</span>
                        </div>
                    ))}
                </div>
            );
        }

        function AdminPanel({ orders, materials, db, dbId }) {
            const handleUpdate = (id, s, t) => {
                const c = t === 'material' ? 'materials' : 'orders';
                db.collection('artifacts').doc(dbId).collection('public').doc('data').collection(c).doc(id).update({status: s});
            };
            return (
                <div className="space-y-8">
                    <h2 className="text-3xl font-bold">Admin Console</h2>
                    <div className="grid md:grid-cols-2 gap-8">
                        <div className="bg-white p-6 rounded-3xl border shadow-sm">
                            <h3 className="font-bold mb-4 border-b pb-2">Material Requests</h3>
                            {materials.map(m => (
                                <div key={m.id} className="py-2 border-b flex justify-between text-sm">
                                    <span>{m.name}</span>
                                    <button onClick={() => handleUpdate(m.id, 'approved', 'material')} className="text-green-600 font-bold">Approve</button>
                                </div>
                            ))}
                        </div>
                        <div className="bg-white p-6 rounded-3xl border shadow-sm">
                            <h3 className="font-bold mb-4 border-b pb-2">Quotation Requests</h3>
                            {orders.map(o => (
                                <div key={o.id} className="py-2 border-b flex justify-between text-sm">
                                    <span>{o.name}</span>
                                    <button onClick={() => handleUpdate(o.id, 'approved', 'quote')} className="text-green-600 font-bold">Approve</button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
